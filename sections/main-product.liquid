{% assign current_variant = product.selected_or_first_available_variant %}

<div class="max-w-7xl mx-auto px-4 sm:px-6 py-12">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
    <!-- Image Section -->
    <div class="product-images">
      <!-- Main Swiper -->
      <div class="swiper product-main-swiper border bg-white overflow-hidden">
        <div class="swiper-wrapper">
          {% for image in product.images %}
            <div class="swiper-slide">
              <img
                src="{{ image.src | image_url: width: 800 }}"
                alt="{{ image.alt | escape }}"
                width="800"
                height="800"
                class="w-full h-full object-contain"
                loading="lazy"
              >
            </div>
          {% endfor %}
        </div>
        <!-- Custom Navigation -->
        <div class="swiper-button-next custom-swiper-nav">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-8 h-8">
            <path d="M10 20A10 10 0 1 0 0 10a10 10 0 0 0 10 10zM8.711 4.3l5.7 5.766L8.7 15.711l-1.4-1.422 4.289-4.242-4.3-4.347z"/>
          </svg>
        </div>
        <div class="swiper-button-prev custom-swiper-nav">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-8 h-8 rotate-180">
            <path d="M10 20A10 10 0 1 0 0 10a10 10 0 0 0 10 10zM8.711 4.3l5.7 5.766L8.7 15.711l-1.4-1.422 4.289-4.242-4.3-4.347z"/>
          </svg>
        </div>
      </div>

      <div class="swiper product-thumb-swiper mt-4">
        <div class="swiper-wrapper">
          {% for image in product.images %}
            <div class="swiper-slide cursor-pointer opacity-50 transition-opacity hover:opacity-100 swiper-slide-thumb-active:opacity-100">
              <div class="border overflow-hidden shrink-0">
                <img
                  src="{{ image.src | image_url: width: 200 }}"
                  alt="{{ image.alt | escape }}"
                  width="200"
                  height="200"
                  class="w-full aspect-square object-cover"
                  loading="lazy"
                >
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="flex flex-col">
      {% for block in section.blocks %}
        {% case block.type %}
          {% when '@app' %}
            {% render block %}

          {% when 'title' %}
            <h1 class="text-3xl font-semibold text-gray-900" {{ block.shopify_attributes }}>
              {{ product.title }}
            </h1>

          {% when 'price' %}
            <div class="mt-3" {{ block.shopify_attributes }}>
              <p class="text-2xl font-medium text-gray-900">
                {{ current_variant.price | money }}
              </p>
            </div>

          {% when 'variant_selector' %}
            <div class="mt-6" {{ block.shopify_attributes }}>
              <label for="productSelect-{{ section.id }}" class="block text-sm font-medium text-gray-700 mb-1">
                Variant
              </label>
              <select
                name="id"
                id="productSelect-{{ section.id }}"
                class="w-full border px-4 py-3 focus:outline-none focus:ring-2 focus:ring-black"
                form="AddToCartForm-{{ section.id }}"
              >
                {% for variant in product.variants %}
                  {% if variant.available %}
                    <option
                      value="{{ variant.id }}"
                      {% if variant == current_variant %}
                        selected="selected"
                      {% endif %}
                    >
                      {{ variant.title }} — {{ variant.price | money_with_currency }}
                    </option>
                  {% else %}
                    <option disabled>{{ variant.title }} — Sold out</option>
                  {% endif %}
                {% endfor %}
              </select>
            </div>

          {% when 'quantity_selector' %}
            <div class="mt-6 flex items-center gap-4" {{ block.shopify_attributes }}>
              <label for="Quantity-{{ section.id }}" class="text-sm font-medium text-gray-700"> Qty </label>
              <input
                type="number"
                id="Quantity-{{ section.id }}"
                name="quantity"
                value="1"
                min="1"
                class="w-20 border px-3 py-2 text-center focus:outline-none focus:ring-2 focus:ring-black"
                form="AddToCartForm-{{ section.id }}"
              >
            </div>

          {% when 'buy_buttons' %}
            <div class="mt-8" {{ block.shopify_attributes }}>
              <form
                id="AddToCartForm-{{ section.id }}"
                action="{{ routes.cart_add_url }}"
                method="post"
                enctype="multipart/form-data"
              >
                <input type="hidden" name="id" value="{{ current_variant.id }}">
                <button
                  type="submit"
                  name="add"
                  id="AddToCart-{{ section.id }}"
                  class="w-full bg-black text-white py-4 text-lg font-semibold hover:bg-gray-900 transition"
                  {% unless current_variant.available %}
                    disabled
                  {% endunless %}
                >
                  {% if current_variant.available %}Add to cart{% else %}Sold out{% endif %}
                </button>
              </form>
            </div>

          {% when 'description' %}
            <div class="mt-12" {{ block.shopify_attributes }}>
              <h2 class="text-xl font-semibold mb-4">Product Details</h2>
              <div class="prose prose-gray max-w-none">
                {{ product.description }}
              </div>
            </div>

          {% when 'faq' %}
            {% assign faq_questions = product.metafields.custom.faq_questions.value %}
            {% assign faq_answers = product.metafields.custom.faq_answers.value %}
            {% if faq_questions != blank %}
              <div class="mt-16" {{ block.shopify_attributes }}>
                <h2 class="text-xl font-semibold mb-6">Frequently Asked Questions</h2>
                <div class="divide-y border-t">
                  {% for question in faq_questions %}
                    {% assign index = forloop.index0 %}
                    {% assign answer = faq_answers[index] %}
                    <details class="py-4 group">
                      <summary class="flex justify-between items-center cursor-pointer text-gray-900 font-medium">
                        <span>{{ question }}</span>
                        <span class="transition group-open:rotate-180">⌄</span>
                      </summary>
                      <div class="mt-3 text-gray-600 leading-relaxed">
                        {{ answer }}
                      </div>
                    </details>
                  {% endfor %}
                </div>
              </div>
            {% endif %}

          {% when 'tags' %}
            {% if product.tags.size > 0 %}
              <div class="mt-2 flex flex-wrap gap-2" {{ block.shopify_attributes }}>
                {% for tag in product.tags %}
                  <span class="inline-flex items-center px-2.5 py-0.5 text-xs font-medium bg-red-100 text-red-800">
                    {{ tag }}
                  </span>
                {% endfor %}
              </div>
            {% endif %}
        {% endcase %}
      {% endfor %}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Main Product",
  "settings": [],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "title",
      "name": "Title",
      "limit": 1
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1
    },
    {
      "type": "variant_selector",
      "name": "Variant Selector",
      "limit": 1
    },
    {
      "type": "quantity_selector",
      "name": "Quantity Selector",
      "limit": 1
    },
    {
      "type": "buy_buttons",
      "name": "Buy Buttons",
      "limit": 1
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1
    },
    {
      "type": "faq",
      "name": "FAQ",
      "limit": 1
    },
    {
      "type": "tags",
      "name": "Tags",
      "limit": 1
    }
  ],
  "presets": [
    {
      "name": "Main Product",
      "blocks": [
        { "type": "title" },
        { "type": "tags" },
        { "type": "price" },
        { "type": "variant_selector" },
        { "type": "quantity_selector" },
        { "type": "buy_buttons" },
        { "type": "description" },
        { "type": "faq" }
      ]
    }
  ]
}
{% endschema %}
